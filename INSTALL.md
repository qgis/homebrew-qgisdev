**QGIS 3.2 Bonn on macOS with Homebrew**

![QGIS](https://raw.githubusercontent.com/fjperini/homebrew-qgisdev/matplotlib-fix%2Bpython/screenshot.png "QGIS")

`$ brew tap qgis/qgisdev`

Or install via URL (which will not receive updates):

`brew install https://raw.githubusercontent.com/qgis/homebrew-qgisdev/master/Formula/qgis3-dev.rb`

Another solution is to copy all the content directly to: `../Taps/qgis/homebrew-qgisdev`

`$ cd /usr/local/Homebrew/Library/Taps/qgis/homebrew-qgisdev`

`$ git checkout -b matplotlib-fix+python`

`$ brew edit qgis3-dev`

Fix for matplotlib and python. Change to:

```
url "https://github.com/qgis/QGIS.git", :branch => "release-3_2"
version â€œ3.2.0"
```

```
depends_on â€œpython"`
```

```
# depends_on "homebrew/science/matplotlib" # deprecated
depends_on "brewsci/bio/matplotlib"
```

`$ git add Formula/qgis3-dev.rb`

`$ git commit -m "fix for matplotlib and pythonâ€`


See [changes](https://github.com/fjperini/homebrew-qgisdev/blob/matplotlib-fix%2Bpython/Formula/qgis3-dev.rb). You can copy the entire file to make sure.

For, `ImportError: No module named site`

`$ brew install pyqt`

`$ brew install bison`

```
> $ python --version
Python 3.6.5
```

```
> $ python3 --version
Python 3.6.5
```

```
> $ python2 --version
Python 2.7.15
```

Modify the file `/usr/local/bin/pyrcc5` and change `pythonw2.7` to `python3`: 

```
#!/bin/sh
exec python3 -m PyQt5.pyrcc_main ${1+"$@"}
```

Build and install

`$ brew install proj` # `--build-from-source`

Proj v5.1.0 # With Proj v4: Library not loaded: libproj.13.dylib

`$ brew install libspatialite` # `--build-from-source`

`$ brew install libgeotiff` # `--build-from-source`

`$ brew install osgeo/osgeo4mac/gdal2` # recommended. Other: `gdal`

You can use the options:

 `--with-complete` `--with-unsupported` `--with-armadillo` `--with-libkml` `--with-opencl`
`--with-postgresql` `--with-java` `--with-swig-java`

`$ brew install -v --no-sandbox qgis3-dev --with-grass  --with-saga-gis-lts`  # other:  `--with-r` `--with-3d`

It can stop at the end of the `gdal2` installation, for that reason we installed it before. If it stops, just rerun the above command to continue with the installation of QGIS.

The same thing happens in Travis CI [(PR)](https://github.com/qgis/homebrew-qgisdev/pull/69) when doing a pull request:

```console
==> Installing qgis/qgisdev/qgis3-dev dependency: osgeo/osgeo4mac/gdal2
==> Downloading https://dl.bintray.com/homebrew-osgeo/osgeo-bottles/gdal2-2.3.0.
==> Pouring gdal2-2.3.0.sierra.bottle.tar.gz
==> Caveats
Plugins for this version of GDAL/OGR, generated by other formulae, should
be symlinked to the following directory:
  /usr/local/lib/gdalplugins/2.3
You may need to set the following enviroment variable:
  export GDAL_DRIVER_PATH=/usr/local/lib/gdalplugins
PYTHON BINDINGS are now built in a separate formula: gdal2-python
This formula is keg-only, which means it was not symlinked into /usr/local,
because older version of gdal is in main tap and installs similar components.
If you need to have this software first in your PATH run:
  echo 'export PATH="/usr/local/opt/gdal2/bin:$PATH"' >> ~/.bash_profile
For compilers to find this software you may need to set:
    LDFLAGS:  -L/usr/local/opt/gdal2/lib
    CPPFLAGS: -I/usr/local/opt/gdal2/include
For pkg-config to find this software you may need to set:
    PKG_CONFIG_PATH: /usr/local/opt/gdal2/lib/pkgconfig
==> Summary
ðŸº  /usr/local/Cellar/gdal2/2.3.0: 231 files, 45.9MB
The command "./travis/install.sh" failed and exited with 1 during .
Your build has been stopped.
/Users/travis/.travis/job_stages: line 187: shell_session_update: command not found
```
Suggestions to correct it?

After finish building QGIS, move the app from the Homebrew Cellar to the `/Applications` folder, and rename the app to `QGIS 3.app`.


`$ mv /usr/local/opt/qgis3-dev/QGIS.app /Applications/QGIS\ 3.app`

`$ ln -s /Applications/QGIS\ 3.app /usr/local/opt/qgis3-dev/QGIS.app`

To run

GRASS: `$ grass74` # in the installation: `ln -s ../Cellar/grass7/7.4.0/bin/grass74 /usr/local/bin/grass74`

SAGA:  `$ saga_gui` # create a direct link : `ln -s ../Cellar/saga-gis-lts/2.3.2/bin/saga_gui /usr/local/bin/saga_gui`

To create the `SAGA.app` package use `saga-gis-lts --with-app`. With fails:

```console
/bin/sh ../../../libtool  --tag=CXX   --mode=compile clang++ -DHAVE_CONFIG_H -I. -I../../..    -fPIC -Wall `wx-config --unicode=yes --cxxflags base` -D_SAGA_LINUX -D_SAGA_UNICODE -D_TYPEDEF_BYTE -D_TYPEDEF_WORD -D_SAGA_API_EXPORTS     -g -O2 -c -o table_io.lo table_io.cpp
libtool: compile:  clang++ -DHAVE_CONFIG_H -I. -I../../.. -fPIC -Wall -I/usr/local/lib/wx/include/osx_cocoa-unicode-3.0 -I/usr/local/include/wx-3.0 -D_FILE_OFFSET_BITS=64 -DWXUSINGDLL -D__WXMAC__ -D__WXOSX__ -D__WXOSX_COCOA__ -DwxUSE_GUI=0 -D_SAGA_LINUX -D_SAGA_UNICODE -D_TYPEDEF_BYTE -D_TYPEDEF_WORD -D_SAGA_API_EXPORTS -g -O2 -c shapes_polygons.cpp -o shapes_polygons.o >/dev/null 2>&1
table.cpp:904:16: error: ordered comparison between pointer and zero ('CSG_Table_Record **' and 'int')
        if( m_Records > 0 )
            ~~~~~~~~~ ^ ~
1 error generated.
make[3]: *** [table.lo] Error 1
make[3]: *** Waiting for unfinished jobs....
libtool: compile:  clang++ -DHAVE_CONFIG_H -I. -I../../.. -fPIC -Wall -I/usr/local/lib/wx/include/osx_cocoa-unicode-3.0 -I/usr/local/include/wx-3.0 -D_FILE_OFFSET_BITS=64 -DWXUSINGDLL -D__WXMAC__ -D__WXOSX__ -D__WXOSX_COCOA__ -DwxUSE_GUI=0 -D_SAGA_LINUX -D_SAGA_UNICODE -D_TYPEDEF_BYTE -D_TYPEDEF_WORD -D_SAGA_API_EXPORTS -g -O2 -c table_dbase.cpp  -fno-common -DPIC -o .libs/table_dbase.o
libtool: compile:  clang++ -DHAVE_CONFIG_H -I. -I../../.. -fPIC -Wall -I/usr/local/lib/wx/include/osx_cocoa-unicode-3.0 -I/usr/local/include/wx-3.0 -D_FILE_OFFSET_BITS=64 -DWXUSINGDLL -D__WXMAC__ -D__WXOSX__ -D__WXOSX_COCOA__ -DwxUSE_GUI=0 -D_SAGA_LINUX -D_SAGA_UNICODE -D_TYPEDEF_BYTE -D_TYPEDEF_WORD -D_SAGA_API_EXPORTS -g -O2 -c table_io.cpp  -fno-common -DPIC -o .libs/table_io.o
libtool: compile:  clang++ -DHAVE_CONFIG_H -I. -I../../.. -fPIC -Wall -I/usr/local/lib/wx/include/osx_cocoa-unicode-3.0 -I/usr/local/include/wx-3.0 -D_FILE_OFFSET_BITS=64 -DWXUSINGDLL -D__WXMAC__ -D__WXOSX__ -D__WXOSX_COCOA__ -DwxUSE_GUI=0 -D_SAGA_LINUX -D_SAGA_UNICODE -D_TYPEDEF_BYTE -D_TYPEDEF_WORD -D_SAGA_API_EXPORTS -g -O2 -c table_dbase.cpp -o table_dbase.o >/dev/null 2>&1
libtool: compile:  clang++ -DHAVE_CONFIG_H -I. -I../../.. -fPIC -Wall -I/usr/local/lib/wx/include/osx_cocoa-unicode-3.0 -I/usr/local/include/wx-3.0 -D_FILE_OFFSET_BITS=64 -DWXUSINGDLL -D__WXMAC__ -D__WXOSX__ -D__WXOSX_COCOA__ -DwxUSE_GUI=0 -D_SAGA_LINUX -D_SAGA_UNICODE -D_TYPEDEF_BYTE -D_TYPEDEF_WORD -D_SAGA_API_EXPORTS -g -O2 -c table_io.cpp -o table_io.o >/dev/null 2>&1
make[2]: *** [install-recursive] Error 1
make[1]: *** [install-recursive] Error 1
make: *** [install-recursive] Error 1
```

Solution for this?

There is also the package `saga-gis` where it is reported:

`
keg_only "QGIS fails to load the correct SAGA version, if the latest version is in the path"
`

For `GRASS.app`, it is not available in `grass7`.

The `grass7` package can also be installed with `--with-netcdf`.

To solve the integration problem of `R in QGIS` see this [post](https://gis.stackexchange.com/questions/200793/integrating-r-in-qgis-with-mac-os-el-captain-missing-dependencies). Suggestions for this?

References:

[http://luisspuerto.net/2018/03/qgis-on-macos-with-homebrew/](http://luisspuerto.net/2018/03/qgis-on-macos-with-homebrew/)

[https://github.com/qgis/homebrew-qgisdev/issues/62](https://github.com/qgis/homebrew-qgisdev/issues/62)

[https://github.com/qgis/homebrew-qgisdev/issues/64](https://github.com/qgis/homebrew-qgisdev/issues/64)

[https://github.com/qgis/homebrew-qgisdev/issues/66](https://github.com/qgis/homebrew-qgisdev/issues/66) 

[https://grasswiki.osgeo.org/wiki/Compiling_on_MacOSX_using_homebrew](https://grasswiki.osgeo.org/wiki/Compiling_on_MacOSX_using_homebrew)

[https://sourceforge.net/p/saga-gis/wiki/Compiling%20SAGA%20on%20Mac%20OS%20X/](https://sourceforge.net/p/saga-gis/wiki/Compiling%20SAGA%20on%20Mac%20OS%20X/)
